# 3.1 模块一：基于用户输入信息的意图理解（优化版）

本模块的核心目标是精准解析高职教师的知识点课件制作核心需求，包括授课学科、专业领域类别、核心知识点（单个或多个）、知识点关联关系、教学目标（知识目标、能力目标、素养目标）、课时安排、课件页数要求、教学场景（理论讲解/实训应用/复习巩固）、是否需要融入知识点应用案例/习题/互动环节等关键信息，为后续课件风格设计和内容生成提供依据。本优化版在原方案基础上新增专业领域识别（7大类）、基于研究数据的智能页数计算、多轮交互确认机制等功能。

### 3.1.1 输入方式支持

*   **文本描述输入**：教师通过自然语言描述课件需求（如”生成一份高职机械基础’齿轮传动原理’知识点的理论课课件，重点突出原理核心要点和简单应用场景，包含2个实操案例，风格简洁清晰，约8页”）。系统支持多种引号格式（中文引号、英文引号、书名号）识别知识点内容。
*   **关键词输入**：教师输入核心关键词（如”高职护理、静脉输液操作、单个知识点、实训课件、操作步骤、红色警示标注”）。系统自动识别专业领域并推断教学场景。
*   **文档上传输入**：教师上传知识点清单、知识点教案片段、教材知识点节选等文件，系统解析文件内容提取核心教学需求。（规划功能）

### 3.1.2 意图解析流程

#### 3.1.2.1 数据预处理
对用户输入文本进行清洗（去除无效字符），对上传文档进行格式解析 and 内容提取。采用大语言模型整体语义理解为主，启发式正则匹配为降级方案，提升系统鲁棒性。

#### 3.1.2.1.1 增强的提示设计
基于设计哲学驱动的方法，系统提示包含以下核心原则：
- **内容驱动的理解**：让教学内容本身指导需求分析，而不是套用固定模板
- **专业领域验证**：遇到不熟悉的知识点必须通过工具搜索验证
- **合理预估**：基于搜索结果和教学经验进行合理参数预估
- **用户体验优先**：提供清晰的确认机制，避免误解用户需求

用户提示支持参数化配置：
- **语气控制 (tone)**：可指定分析风格，如"严格"、"灵活"等
- **详细程度 (verbosity)**：控制输出详细程度
- **特殊指令 (instructions)**：用户自定义的额外要求

#### 3.1.2.2 关键信息抽取
基于大语言模型，采用 Few-Shot 提示工程、智能工具调用和关键词提取算法，抽取以下信息：

##### 工具调用策略优化
- **主动搜索场景**：遇到任何不确定的专业术语或知识点名称时，优先使用web_search工具进行验证
- **智能搜索技巧**：组合关键词搜索（知识点名称 + "高职" + "教学" + "职业教育"），优先中文内容
- **降级处理机制**：工具调用失败时自动降级到非工具模式，确保系统稳定性
- **精确解析**：改进JSON响应解析，支持多种响应格式，提高解析成功率

##### 智能评估功能
- **知识点难度自动评估**：基于关键词分析、名称复杂度评估和专业领域适配进行难度分级
  * easy（简单）：基础概念、简单定义、入门知识
  * medium（中等）：原理讲解、基本应用、标准难度（默认）
  * hard（较难）：复杂计算、高级应用、深入分析
- **教学场景智能识别**：通过关键词匹配和上下文分析自动识别教学类型
  * theory（理论）："理论"、"原理"、"概念"、"基础"等关键词
  * practice（实践）："实训"、"操作"、"动手"、"步骤"等关键词
  * review（复习）："复习"、"回顾"、"总结"、"巩固"等关键词
- **后处理修正**：对LLM评估结果进行校验和修正，确保评估准确性

**基础信息抽取项**：
*   授课学科：具体学科名称（如机械、护理、计算机等）
*   专业领域类别：7大领域分类（详见专业领域分类表）
*   核心知识点：单个或多个知识点列表（结构化对象，包含名称、类型、智能评估难度等）
*   知识点关联关系：知识点之间的逻辑关系描述

**教学配置抽取项**：
*   教学目标：知识目标、能力目标、素养目标（支持自动生成）
*   教学场景：理论讲解、实训应用、复习巩固（支持智能自动识别）
*   课时安排：授课时长（分钟，默认45分钟）
*   课件页数：用户期望页数（支持最小页数智能计算）

**特殊需求抽取项**：
*   案例需求：是否包含应用案例及数量
*   习题需求：是否包含习题巩固
*   互动需求：是否包含互动环节
*   警示标注：是否需要安全警示标识

**智能评估补充项**：
*   知识点难度评估：基于内容复杂度自动分级（easy/medium/hard）
*   教学场景识别：通过关键词和上下文自动判断教学类型
*   默认参数填充：对未明确信息提供合理的默认值

**专业领域分类表**：

| 类别代码 | 类别名称 | 包含专业 | 风格特点 |
| :--- | :--- | :--- | :--- |
| engineering | 工科/工程类 | 机械、电气、汽修、数控、建筑、焊接、模具 | 强化参数结构和技术图纸展示 |
| medical | 医学/护理类 | 护理、医学、药学、康复、临床、解剖 | 强化流程步骤和安全规范展示 |
| agriculture | 农林类 | 农业、林业、园艺、畜牧、森林、生态 | 强化生态大图和环境关系展示 |
| arts | 人文艺术类 | 设计、艺术、语文、音乐、舞蹈、思政、教育 | 强化留白意境和美学表达 |
| business | 商科类 | 会计、电商、金融、物流、营销、管理 | 强化数据看板和商业分析展示 |
| science | 理科类 | 数学、物理、化学、计算机、网页、编程 | 强化逻辑推导和公式展示 |
| civil | 土木桥梁类 | 土木、桥梁、施工、道路、隧道、建工 | 强化工程详图和施工流程展示 |
| transportation | 交通运输类 | 铁道、城轨、民航、航海、汽车运用、港口 | 强化运输流程图和交通网络展示 |
| tourism | 旅游类 | 旅游、酒店、导游、会展策划、烹饪、景区 | 强化服务流程和场景化展示 |
| food | 食品药品类 | 食品加工、食品检测、药品生产、药品经营 | 强化工艺流程和质量控制展示 |
| textile | 轻工纺织类 | 纺织、服装设计、印刷、包装、家具设计 | 强化工艺细节和产品展示 |
| resources | 资源环境类 | 地质、测绘、矿业、石油、环境保护、安全 | 强化地理信息和环境数据展示 |
| water | 水利类 | 水利工程、水电站、水文测报、港航工程 | 强化水系图和工程结构展示 |
| media | 新闻传播类 | 新闻采编、广播影视、数字媒体、新媒体 | 强化多媒体内容和传播路径展示 |
| public-security | 公安司法类 | 刑事执行、司法警务、法律事务、社区矫正 | 强化流程规范和法律条文展示 |
| public-service | 公共管理服务类 | 人力资源、社会工作、养老服务、家政服务 | 强化服务流程和人员关系展示 |
| sports | 体育类 | 体育教育、运动训练、社会体育、健身指导 | 强化动作示范和训练计划展示 |

#### 3.1.2.3 意图归一化
将抽取的关键信息映射到系统预设的标准化教学需求维度：
*   **风格类型映射**：根据教学场景映射为”理论课简洁型”“实训课步骤型”“复习课思维导图型”等预设类型。
*   **专业风格联动**：根据专业领域类别自动关联对应的风格预设，如医学护理类自动应用安全规范强化风格。
*   **模糊需求处理**：教师未指定风格时，根据教学场景自动推荐默认风格。理论课默认简洁清晰风格，实训课默认步骤化风格，复习课默认思维导图风格。

#### 3.1.2.4 智能页数计算
基于30份高职精品PPT结构分析研究，建立页数计算模型：

**页数计算公式**：
*   基础页数 = 5（封面 + 目录 + 教学目标 + 总结 + 思考题）
*   内容页数 = 知识点数量 × 3
*   习题页数 = ⌈知识点数量 / 2⌉
*   最小推荐页数 = (基础页数 + 内容页数 + 习题页数) × 专业系数

**专业系数表**：

| 专业领域 | 系数 | 说明 |
| :--- | :--- | :--- |
| science（理科类） | 0.8 | 公式推导为主，页数相对较少 |
| civil（土木桥梁类） | 1.3 | 工程案例需要详细展示 |
| arts（人文艺术类） | 1.2 | 内容丰富，需要更多视觉留白 |
| 其他类别 | 1.0 | 标准系数 |

**研究数据支撑**：
*   样本数量：30份精品PPT
*   平均页数：19.1页
*   页数范围：6-35页
*   中位数：18页

#### 3.1.2.5 需求校验与多轮交互补全
对缺失的关键信息，通过结构化多轮交互引导教师补充，或基于学科课程标准默认填充。

**交互流程设计**：
1.  **必填字段校验**：检查学科、知识点等必填字段是否完整。若缺失，生成对应的补充问题引导用户输入。
2.  **知识点完整性确认**：系统识别知识点后，向用户确认"当前已识别知识点：[知识点列表]，是否需要补充更多知识点？"用户可选择补充或确认继续。
3.  **页数冲突检测**：若用户期望页数小于系统计算的最小推荐页数，向用户提示"根据知识点内容，建议至少N页，是否调整为建议页数？"
4.  **知识点补充询问**：条件式询问用户是否需要补充知识点，避免显示不必要的输入框。
5.  **知识点补充输入**：只有用户确认需要补充时，才显示知识点输入框，支持多个知识点用逗号分隔。
6.  **配置修改询问**：用户确认知识点补充后，询问是否需要修改默认配置，显示当前默认配置信息。
7.  **条件配置调整**：只有用户选择需要修改时，才进入详细的配置调整界面。
8.  **智能最终优化**：根据是否有补充信息决定是否调用大模型进行最终优化，确保结果的准确性和完整性。

**增强的错误处理机制**：
- **统一错误处理**：各阶段失败时提供相应的降级方案，确保系统稳定性
- **详细错误日志**：记录错误发生的具体情况、上下文信息和恢复策略
- **工具调用容错**：网络搜索失败时自动切换到本地解析模式
- **参数配置支持**：支持tone、verbosity、instructions等参数的灵活配置

### 3.1.3 输出结果

生成标准化的教学需求文档（`TeachingRequest`），包含以下嵌套字段：

**基础信息**

| 字段名称 | 子字段 | 数据类型 | 说明 |
| :--- | :--- | :--- | :--- |
| **subject_info** | subject_name | 字符串 | 授课学科名称 |
| | subject_category | 枚举 | 专业领域类别（7选1） |
| | sub_field | 字符串 | 具体子领域 |
| **knowledge_points** | (list) | 对象列表 | 核心知识点列表 |
| | id / name | 字符串 | 知识点ID与名称 |
| | type | 枚举 | theory/practice/mixed |

**教学配置**

| 字段名称 | 子字段 | 数据类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **teaching_scenario**| scene_type | 枚举 | unknown | 教学场景（theory/practice/review） |
| **slide_requirements**| lesson_duration_min| 整数 | 45 | 课时时长（分钟） |
| | target_count | 整数 | 空 | 用户期望页数 |
| | min_count | 整数 | 计算值 | 系统推荐最小页数 |

**教学目标 (`teaching_objectives`)**

| 字段名称 | 子字段 | 数据类型 | 说明 |
| :--- | :--- | :--- | :--- |
| **teaching_objectives**| knowledge | 字符串数组 | 知识目标描述列表 |
| | ability | 字符串数组 | 能力目标描述列表 |
| | literacy | 字符串数组 | 素养目标描述列表 |

**特殊教学需求 (`special_requirements`)**

| 字段名称 | 子字段 | 数据类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **special_requirements**| cases | 对象 | {enabled:true, count:2} | 案例需求 |
| | exercises | 对象 | {enabled:true, total_count:3} | 习题需求 |
| | interaction | 对象 | {enabled:true, types:[]} | 互动需求 |
| | warnings | 对象 | {enabled:false} | 警示标注 |
| | animations | 对象 | {enabled:false} | 动画效果 |

**交互状态**

| 字段名称 | 数据类型 | 说明 |
| :--- | :--- | :--- |
| interaction_stage | 枚举 | 当前交互阶段 (initial/confirm_kp/confirm_assessments/modify_assessments/confirm_goals/final_confirm等) |
| display_summary | 字符串 | 已格式化的需求确认摘要 |
| evaluation_metadata | 对象 | 智能评估的元数据信息（评估方法、置信度等） |

### 3.1.4 与后续模块的联动

| 后续模块 | 联动内容 |
| :--- | :--- |
| 3.2 风格设计模块 | 根据 `subject_category` 字段自动匹配对应的风格预设模板 |
| 3.3 大纲生成模块 | 根据 `knowledge_points` 详情与 `min_count` 智能分配页面结构 |
| 3.4 内容生成模块 | 根据 `special_requirements` 决定习题、案例、互动的生成策略 |

### 3.1.5 系统提示信息

系统在交互过程中向用户展示默认配置说明：

> **温馨提示**：如未特别说明，系统将按以下默认配置生成课件：
> *   课时：45分钟
> *   应用案例：包含
> *   习题巩固：包含
> *   互动环节：包含
>
> 您可以在确认环节中调整上述配置。

#### 参数配置选项
系统支持以下高级参数配置，方便用户定制化需求：

| 参数名称 | 参数类型 | 说明 | 示例值 |
| :--- | :--- | :--- | :--- |
| **tone** | 字符串 | 分析风格控制 | "严格验证"、"灵活适配" |
| **verbosity** | 字符串 | 输出详细程度 | "详细"、"简洁" |
| **instructions** | 字符串 | 用户自定义指令 | "重点关注实践应用"、"简化理论内容" |
| **use_tools** | 布尔值 | 是否启用工具调用 | true/false |

这些参数可通过API接口或系统配置进行设置，提供更灵活的意图理解体验。

### 3.1.6 优化改进点

基于工作流分析和用户体验优化，本模块实施了以下关键改进：

#### 6.1 提示设计优化
- **设计哲学驱动**：引入"内容驱动的理解"和"专业领域验证"等核心原则
- **结构化提示**：将系统提示和用户提示分离，支持参数化配置
- **灵活参数支持**：支持tone、verbosity、instructions等参数定制

#### 6.2 工具调用增强
- **智能搜索策略**：优化搜索关键词组合，提高专业信息检索准确性
- **降级处理机制**：工具调用失败时自动切换到本地解析，确保系统稳定性
- **精确响应解析**：改进JSON解析算法，支持多种响应格式，提高解析成功率

#### 6.3 智能评估功能
- **知识点难度评估**：基于多维度分析（关键词、复杂度、领域特点）进行自动分级
- **教学场景识别**：通过智能关键词匹配和上下文分析自动识别教学类型
- **后处理修正机制**：对LLM评估结果进行校验和智能修正，确保准确性
- **评估结果展示**：在用户界面清晰展示评估依据和结果，便于用户理解

#### 6.5 错误处理强化
- **统一错误处理框架**：建立标准的错误处理和日志记录机制
- **上下文信息记录**：详细记录错误发生时的上下文，便于问题排查
- **用户友好提示**：提供清晰的错误反馈和恢复建议

#### 6.6 系统稳定性提升
- **容错性增强**：多层降级策略，确保关键功能在异常情况下仍能运行
- **性能优化**：减少不必要的重复计算，提高响应速度
- **可维护性改进**：代码结构优化，便于后续功能扩展

这些优化显著提升了意图理解模块的准确性、稳定性和用户体验，为后续模块提供了更可靠的数据基础。

### 3.1.7 最新功能更新

#### 7.1 大模型驱动的智能评估
- **知识点难度自动评估**：系统现在能够基于大模型智能分析知识点内容的复杂度，自动评估难度等级（简单/中等/较难）
- **教学场景智能识别**：通过自然语言处理技术，自动识别用户需求的教学场景类型，无需用户明确指定
- **评估结果透明化**：所有评估结果都会在界面中清晰展示评估依据，让用户了解系统判断的逻辑

#### 7.2 智能重新优化机制
- **用户反馈驱动优化**：当用户在交互过程中补充或修改信息时，系统自动调用大模型进行内容重新优化
- **动态调整评估结果**：基于用户的最新输入，智能调整知识点难度、教学场景等关键评估参数
- **渐进式完善**：从初始识别→用户确认→智能优化→最终确认的完整优化流程
- **透明化优化记录**：记录每次优化的具体调整内容，让用户了解系统优化逻辑

#### 7.3 用户界面优化
- **分阶段默认配置显示**：在初始输入和确认环节都清晰展示默认配置信息，包括课时、案例、习题、互动等设置
- **条件式输入优化**：只有在用户确认需要补充信息时才显示相应的输入框，避免界面 clutter
- **配置调整确认机制**：在补充信息后专门提供完整的默认配置调整步骤，包括课时、案例、习题、互动等
- **多阶段配置提示**：在不同交互阶段提供相应的配置调整提示，让用户了解何时可以调整配置
- **友好交互提示**：使用温馨的提示语言，降低用户使用门槛
- **实时状态反馈**：在各个交互阶段提供清晰的状态指示和操作指导

#### 7.2 增强的多轮交互流程
- **评估确认阶段**：新增"confirm_assessments"交互阶段，允许用户确认或修改系统的智能评估结果
- **可修改评估**：用户可以选择修改教学场景或知识点难度评估，确保结果符合实际需求
- **智能默认策略**：用户未进行修改时，系统自动应用智能评估结果，保证流程的完整性

#### 7.3 后处理修正机制
- **LLM结果校验**：对大模型返回的结果进行后处理校验，修正可能的错误或不合理之处
- **学科名称智能修正**：自动检测并修正错误分类的学科名称（如"液压传动原理"应为学科"机械"）
- **参数合理化**：自动调整不合理的默认参数（如课时不能超过120分钟）
- **评估置信度标记**：为评估结果添加置信度标记，帮助用户判断结果可靠性

这些最新更新使得意图理解模块不仅能够准确理解用户需求，还能主动提供智能建议，大大提升了用户体验和系统智能化水平。

### 3.1.8 默认配置确认机制

#### 8.1 配置确认流程
系统在用户完成评估确认后，会进入专门的默认配置确认阶段：

1. **配置展示**：系统以列表形式展示所有默认配置项
2. **用户选择**：用户可以选择"确认配置"或"需要调整配置"
3. **调整选项**：如果选择调整，可以针对性地修改课时、案例、习题、互动等配置
4. **确认生效**：调整后的配置将应用到后续的课件生成流程

#### 8.2 配置项说明

| 配置项 | 默认值 | 可调整范围 | 说明 |
|-------|--------|-----------|------|
| **课时** | 45分钟 | 30-120分钟 | 建议授课时长 |
| **应用案例** | 包含 | 包含/不包含 | 是否在课件中融入实际应用案例 |
| **习题巩固** | 包含 | 包含/不包含 | 是否添加练习题和巩固环节 |
| **互动环节** | 包含 | 包含/不包含 | 是否设计互动教学活动 |

#### 8.3 用户体验优势
- **透明化配置**：用户清楚了解系统将如何生成课件
- **灵活调整权**：在确认阶段仍可修改关键配置
- **降低认知负担**：默认配置覆盖大部分使用场景
- **个性化适配**：支持根据具体需求调整配置

这个机制确保了用户在整个交互过程中都能充分了解和控制课件的生成配置。

### 3.1.9 条件式交互流程优化

#### 9.1 流程优化目标
重新设计用户交互流程，实现更智能的用户体验：
- **条件显示输入框**：只有用户确认需要补充时才显示相应输入框
- **配置修改询问**：在知识点补充后单独询问是否需要修改配置
- **智能最终优化**：根据是否有补充信息决定是否调用大模型进行最终优化
- **避免不必要计算**：如果没有补充信息，直接使用原有结果，提高效率

#### 9.2 新的交互阶段
1. **check_additional_kps**：询问是否需要补充知识点
   - 选项：["需要补充", "不需要补充"]
   - 根据选择进入不同分支

2. **add_additional_kps**：知识点补充输入（条件显示）
   - 只有选择"需要补充"时显示
   - 支持多个知识点用逗号分隔
   - 补充后标记`has_additional_kps = True`

3. **ask_config_modification**：询问是否需要修改默认配置
   - 显示当前默认配置信息
   - 选项：["需要修改", "不需要修改"]
   - 根据选择决定是否进入配置调整

4. **adjust_configurations**：完整配置调整（条件进入）
   - 只有选择"需要修改"时显示
   - **课时设置**：预设选项 + 自定义输入
   - **应用案例**：数字输入（0表示不包含）
   - **习题巩固**：数字输入（0表示不包含）
   - **互动环节**：选择包含/不包含
   - 调整后标记`has_config_modification = True`

5. **final_confirm**：智能最终确认
   - 检查是否有补充信息（`has_additional_kps` 或 `has_config_modification`）
   - 如果有补充信息：调用大模型进行最终优化
   - 如果没有补充信息：直接使用原有结果，避免不必要的计算

#### 9.3 用户体验改进
- **减少认知负担**：避免显示用户不需要的输入框
- **灵活配置调整**：支持数值输入和选择，适应不同用户偏好
- **完整信息收集**：一次性收集所有必要信息，避免多次往返
- **智能默认处理**：用户未调整的项目使用系统默认值

#### 9.4 技术实现要点
- **条件渲染**：前端根据交互阶段动态显示相应的问题，避免界面 clutter
- **状态标记**：使用`interaction_metadata`标记是否有补充信息，决定是否调用大模型优化
- **智能优化**：只有在有实际补充信息时才触发最终大模型优化，提高效率
- **数据验证**：对用户输入进行合理性验证和范围限制
- **状态管理**：准确维护用户的交互状态和输入历史
- **错误处理**：提供友好的错误提示和恢复机制

#### 9.5 优化效果
- **用户体验**：减少不必要的输入框显示，提供清晰的流程指引
- **系统效率**：避免无意义的重复计算，提高响应速度
- **结果准确性**：基于完整上下文进行优化，确保教学需求的准确性
- **灵活性**：支持用户按需补充信息，既能快速确认也能深度调整

这个优化后的流程提供了更加智能和高效的用户体验，同时确保了意图理解结果的完整性和准确性。



意图识别：思政点，知识点，技能点